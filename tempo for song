-- Modifications dans la fonction humanDelay pour ajouter de l'aléatoire
local function humanDelay(factor, extraDelay)
    local randomFactor = math.random(90, 105) / 100
    local dynamicFactor = 1 + (math.sin(tick() * 0.1) * 0.05)
    -- Ajouter un délai supplémentaire aléatoire entre 0.3 et 1 seconde si spécifié
    local delay = baseDelay * factor * randomFactor * dynamicFactor
    if extraDelay then
        delay = delay + math.random(300, 1000) / 1000  -- Ajouter entre 0.3 et 1 seconde supplémentaires
    end
    return delay
end

-- Modifier pressKey pour ajouter un délai supplémentaire aléatoire pour certaines touches
local function pressKey(key)
    wait(humanDelay(0.9))
    doshift(key)
    
    -- Appliquer un délai plus long pour certaines touches, par exemple, les touches de modification ou spéciales
    local extraDelay = false
    if key == "a" or key == "e" or key == "s" then
        extraDelay = true  -- Exemple : appliquer un délai supplémentaire pour certaines touches spécifiques
    end
    
    vim:SendKeyEvent(true, string.byte(key:lower()), false, nil)
    wait(humanDelay(0.9, extraDelay))  -- Appliquer un délai normal + délai supplémentaire si nécessaire
    vim:SendKeyEvent(false, string.byte(key:lower()), false, nil)
    endshift()
    wait(humanDelay(0.9))
end

-- Vous pouvez également ajuster la durée de pression des touches dans pressMultipleKeys si nécessaire
local function pressMultipleKeys(keys)
    wait(humanDelay(1.2))
    for _, key in ipairs(keys) do
        doshift(key)
        vim:SendKeyEvent(true, string.byte(key:lower()), false, nil)
    end
    wait(humanDelay(0.9))
    for _, key in ipairs(keys) do
        vim:SendKeyEvent(false, string.byte(key:lower()), false, nil)
        endshift()
    end
    wait(humanDelay(0.9))
end
